/*
 * Butter Application butter.application.js
 * Version 0.1.0
 *
 * Developed by Bocoup on behalf of the Mozilla Foundation
 * Copyright (c) 2011 Bocoup, LLC
 * Authors: Rick Waldron, Alistair McDonald, Boaz Sender
 * Dual licensed under the MIT and GPL licenses.
 * http://code.bocoup.com/license/
 *
 */

(function(y,A){var c=y.parseFloat,g=y.parseInt;A.mixin({capitalize:function(h){return h.charAt(0).toUpperCase()+h.substring(1).toLowerCase()},camel:function(h){return h.replace(/(\-[a-z])/g,function(m){return m.toUpperCase().replace("-","")})},slug:function(h){return h.toLowerCase().match(/[a-z0-9]+/ig).join("-")},pad:function(h){return(h<10?"0":"")+h},fract:function(h,m){return Math.round(h*m)/m},fourth:function(h){return A(h).fract(4)},smpteToSeconds:function(h){h=h.split(":");if(h.length===1)return c(h[0],
10);if(h.length===2)return c(h[0],10)+c(h[1]/12,10);if(h.length===3)return g(h[0]*60,10)+c(h[1],10)+c(h[2]/12,10);if(h.length===4)return g(h[0]*3600,10)+g(h[1]*60,10)+c(h[2],10)+c(h[3]/12,10)}})})(window,_);
(function(y,A,c,g){function h(m,e,i,w,q){this.title=m||null;this.description=e||null;this.remote=i||null;this.theme=w||null;this.layout=q||null;this.data=null;return this}h.properties=["title","description","remote","theme","layout"];g.each(h.properties,function(m){h.prototype[g(m).capitalize()]=function(e){return!e&&this[m]||(this[m]=e)}});h.prototype.prepare=function(m){var e={},i=g.size(m),w=0;g.each(h.properties,function(q){e[q]=this[g(q).capitalize()]()},this);e.data=[];g.each(m,function(q){if(w>
0&&w<i-1){var O={},B={},G=q._natives.type;g.each(q,function(H,P){if(P.indexOf("_")!==0&&H)B[P]=H});O[G]=B;e.data.push(O)}w++});return e};h.prototype.serialize=function(m){return JSON.stringify(this.prepare(m))};h.prototype.slug=function(){return(this.title||"").toLowerCase().match(/[a-z0-9]+/ig).join("-")};h.prototype.parse=function(m){return JSON.parse(this.read(m))};h.prototype.create=function(m,e){if(!g.isString(m)){e=m;m=this.slug()}var i=this.serialize(e);localStorage.setItem(m,i);return{slug:m,
serial:i}};h.prototype.read=function(m){return localStorage.getItem(m)||null};h.prototype.update=function(m,e){return this.create(m,e)};h.prototype.remove=function(m){return localStorage.removeItem(m)};h.getStorageAsObject=function(){for(var m=-1,e=localStorage.length,i={},w;++m<e;){w=localStorage.key(m);i[w]=(new Function("return "+localStorage.getItem(w)))()}return i};y.TrackStore=h})(window,document,$,_,Popcorn);
(function(y,A,c,g,h){var m={currentTime:function(e){var i=(""+Math.round(e*100)/100).split(".")[1]||"";if(i.length===1)i+="0";i||(i="00");return g(Math.floor(e/3600)).pad()+":"+g(Math.floor(e/60)).pad()+":"+g(Math.floor(e%60)).pad()+":"+(i==="0"?"00":i)},mp4:'video/mp4; codecs="avc1, mp4a"',ogv:'video/ogg; codecs="theora, vorbis"',accepts:[".ogv",".mp4",".webm"]};c(function(){var e,i=c(A),w=c(y),q=c("body");c("video");c("source");var O=c("#ui-plugin-select-list"),B=c("#ui-track-event-editor"),G=c("#ui-track-editting"),
H=c("#ui-tracks"),P=c("#ui-tracks-time"),L=c("#ui-scrubber-handle"),S=c("#ui-scrubber,#ui-scrubber-handle"),Y=c(".ui-menu-controls"),Z=c("#ui-video-controls"),D=c("#ui-theme"),E=c("#ui-layout"),aa=c("#ui-export-to"),W=c("#io-current-time"),M=c("#io-video-url"),I=c("#io-video-title"),Q=c("#io-video-description"),ba=c("#io-video-data"),T=c(".ui-load-ready"),ca=c("#ui-loading-html"),da=c("#ui-start-screen"),o=null,U=null,F={},v,J,z,X;c("button,.ui-menu-controls").button();c(".ui-accordion-panel").accordion().css("marginTop",
"-1px");c(".ui-menuset").each(function(){c(this).next("ul").menu({select:function(){c(this).hide()},input:c(this)}).css({position:"absolute",zIndex:999}).hide()}).bind("click",function(){var a=c(this).next("ul");c(".ui-menuset ~ ul").hide();if(a.is(":visible")){a.hide();return false}a.menu("deactivate").show().css({top:0,left:0}).position({my:"left top",at:"left bottom",of:this});i.one("click",function(){a.hide()});return false});q.dims={width:q.width(),height:q.height()};w.bind("load resize",function(){q.dims=
{width:q.width(),height:q.height()};ca.css({left:q.dims.width/2-64,top:q.dims.height/2-120,width:130});c(".ui-menuset ~ ul").hide().css({top:0,left:0});S.css({height:G.height()})});T.hide();J=function(){return{project:{unload:function(){},load:function(a,b){M.val(b.remote);E.children().removeClass("active").each(function(d,f){var j=c(f);if(j.text().replace(/\s/g,"").toLowerCase()===b.layout){j.addClass("active");E.attr("data-layout",b.layout)}});D.children().removeClass("active").each(function(d,
f){var j=c(f);if(j.text().replace(/\s/g,"").toLowerCase()===b.theme){j.addClass("active");D.attr("data-theme",b.theme)}});v.loadVideoFromUrl(function(){g.each(a,function(d){g.each(d,function(f,j){var k=g.extend({},{id:j},f);z.addTrackEvent.call(k,k)})});I.val(b.title);Q.val(b.description)})}},menu:{unload:function(a){a=c(a+" li");a.length&&a.remove()},load:function(a){this.unload(a);var b=TrackStore.getStorageAsObject(),d;if(g.size(b)>0)g.each(TrackStore.getStorageAsObject(),function(f,j){d=c("<li/>",
{html:'<h4><img class="icon" src="img/dummy.png">'+f.title+"</h4>",className:"select-li clickable","data-slug":j}).appendTo(a);d.data("track",f.data);d.data("project",f)});else d=c("<li/>",{html:'<h4><em class="quiet">You have no saved movies</em></h4>'}).appendTo(a)}}}}();y.TrackMeta=J;J.menu.load("#ui-user-videos");J.menu.load("#ui-start-screen-list");da.dialog({modal:true,autoOpen:true,width:400,height:400,buttons:{Start:function(){var a=c(this),b=a.children("input").val();a.dialog("close");M.val(b);
c('[data-control="load"]').trigger("click")}}});v=function(a){return{timeLineWidth:0,increment:0,isScrubbing:false,inProgress:false,videoReady:function(b,d){var f=setInterval(function(){if(b.video.readyState>=3&&!isNaN(b.video.duration)){d&&d();i.trigger("videoReady");i.trigger("videoLoadComplete");clearInterval(f)}},13)},timeLineReady:function(b,d){var f=g.bind(function(){this.drawTimeLine(b.video.duration);d&&d();i.trigger("timelineReady")},this);this.videoReady(b,f)},loadVideoFromUrl:function(b){i.trigger("videoLoadStart");
var d=M.val(),f=d.split(".");f=f[f.length-1];var j=this,k,l;c("video").length&&c("video").remove();c("<video/>",{id:"video"}).prependTo("#ui-panel-video");c("<source/>",{type:m[f],src:d}).prependTo("#video");e=h("#video");k=setInterval(function(){if(e.video.currentSrc===d){j.timeLineReady(e,l);clearInterval(k)}},13);l=function(){a.$popcorn=e;var n=c("#ui-tracks-time-canvas"),r=c(".track"),t=c(".ui-plugin-pane"),p=Math.round(n.width()/e.video.duration);I.val("");Q.val("");if(g.size(F))F={};r.length&&
r.remove();t.children().length&&t.children().remove();L.draggable("destroy");L.draggable({scroll:true,scrollSensitivity:50,scrollSpeed:200,axis:"x",containment:"#ui-track-editting",grid:[p/8,0],start:function(){v.isScrubbing=true},stop:function(){v.isScrubbing=false},drag:function(s,C){var u=C.offset.left-n.position().left;u=e.video.duration/n.width()*u;u=g(u).fourth();e.video.currentTime=u}});e.listen("timeupdate",function(){W.val(function(){c(this);var u=g(this.id.replace("io-","")).camel(),K=e[u]();
return m[u](g(K).fourth())});var s=g(e.video.currentTime).fourth(),C=setInterval(function(){if(e.video.readyState>=3){j.setScrubberPosition(p*s+n.position().left,{increments:p,current:s});L.position().left>=H.position().left+H.width()&&H.scrollLeft(n.width());v.inProgress=false;clearInterval(C)}},13);i.trigger("seekComplete",{type:"update",time:s,increment:p,special:function(){}})});e.trigger("timeupdate");b&&b()}},isScrubberWithin:function(b){var d=(L.position().left-G.position().left-1)/(v.increment*
4);return d>=b.start&&d<=b.end},setScrubberPosition:function(b){var d=1,f;if(arguments.length===2){f=arguments[1];f=Math.round(f.current/3);if(f>0)d+=f+f%2}this.isScrubbing||L.css({left:b-d})},deleteCanvas:function(b,d){var f=A.getElementById(d);f&&A.getElementById(b).removeChild(f)},drawCanvas:function(b,d,f,j){var k=A.createElement("canvas");k.id=d;k.width=f;k.height=j;A.getElementById(b).appendChild(k);return k},drawTimeLine:function(b){v.timeLineWidth=Math.ceil(Math.ceil(b)/30)*800;this.deleteCanvas("ui-tracks-time",
"ui-tracks-time-canvas");this.drawCanvas("ui-tracks-time","ui-tracks-time-canvas",v.timeLineWidth,25);var d=A.getElementById("ui-tracks-time-canvas").getContext("2d"),f=v.timeLineWidth/b;b=Math.ceil(b);var j=f/4,k=2,l=0,n=0,r=0,t;v.increment=j;d.font="10px courier";d.fillStyle="#000";for(d.lineWidth=1;l<b*2;l++){if(l>=10)k=6;d.lineWidth=1;d.beginPath();if(l%2||l===0){r++;r<=b&&d.fillText(r,r*f-k,9);t=l*f/2;for(n=0;n<4;n++){d.moveTo(t+n*j,20);d.lineTo(t+n*j,25)}}else{d.moveTo(l*f/2,10);d.lineTo(l*
f/2,25)}d.stroke()}}}}(y);z=function(){return{getTrackEventById:function(a){if(!e.data)return{};var b=h.getTrackEvents(e),d;g.each(b,function(f){if(f._id===a)d=f});return d},destroyTrackEvent:function(a,b,d,f){a.track("killTrackEvent",{_id:d});b.removeTrackEvent(d);b.data.history.indexOf(d)===-1&&i.trigger("removeTrackComplete",{type:f})},addTrackEvent:function(a){if(!e||!e.data)i.trigger("applicationError",{type:"No Video Loaded",message:"I cannot add a Track Event - there is no movie loaded."});
else{var b,d,f,j={},k=this.id,l=h.manifest[k],n={start:2,end:10};arguments.length&&(j=arguments[0]);if(j.currentTarget)j={};g.extend(n,j,{target:h.manifest[k].options.target});g.forEach(l.options,function(r,t){t in n||(n[t]="")});n.id=false;e[k](n);d=e.getLastTrackEventId();e.getTrackEvents();f=z.getTrackEventById(d);if(F[k])b=F[k];else{b=c("<div/>",{title:k,className:"span-21 last track track"+g.size(F)}).insertAfter("#ui-tracks-time");b.width(v.timeLineWidth);b.track({target:c("#video"),duration:e.video.duration});
b.prepend('<span class="large track-label large" >'+g(k).capitalize()+"</span>");F[k]=b}b.track("addTrackEvent",{inPoint:n.start,outPoint:n.end,type:k,popcornEvent:f,popcorn:e,_id:d,editEvent:function(r){if(r.shiftKey)i.trigger("applicationNotice",{message:'Are you sure you want to remove this Track Event? <br><br> <hr class="space">This action is permanent and cannot be undone.',callback:function(){z.destroyTrackEvent(b,e,d,k)}});else{B.dialog({autoOpen:false,title:"Edit "+g(k).capitalize(),buttons:{Cancel:z.editEventCancel,
OK:function(){z.editEventApply.call(f,b,e,d,k);c(this).dialog("close")}}});z.drawTrackEvents.call(this)}}});a?i.trigger(a+"Complete"):i.trigger("addTrackComplete")}},drawTrackEvents:function(){try{B.dialog("close")}catch(a){console&&console.log&&console.log(a)}o=this;var b=o.popcornEvent._natives.manifest.options,d,f;c("#ui-track-event-editor").children("*").remove();if(!o.manifestElems)o.manifestElems={};if(!o.previousValues)o.previousValues={};for(f in b)if(typeof b[f]==="object"){var j=b[f],k=
j.elem;d=j.label;var l;l=c("<"+k+"/>",{className:"text"});o.manifestElems[f]=l;if(g.isNull(U)||U!==o)o.previousValues[f]=o.popcornEvent[f];d=c("<label/>").attr("for",d).text(d);k==="input"&&l.val(o.popcornEvent[f]);k==="select"&&g.each(j.options,function(n){c("<option/>",{value:n,text:g(n).capitalize()}).appendTo(l)});l.appendTo(d);d.appendTo("#ui-track-event-editor")}U=this;B.dialog("open")},editEventApply:function(a,b,d,f){b=o.popcornEvent;var j=b._natives.manifest,k={},l,n;for(l in j.options)if(typeof j.options[l]===
"object"){n=o.manifestElems[l].val();if((b[l]=n)&&["start","end"].indexOf(l)===-1&&!isNaN(n))b[l]=+n}o.inPoint=b.start;o.outPoint=b.end;l=o.popcornEvent;g.each(l,function(r,t){if(t.indexOf("_")!==0&&r)k[t]=r});g.extend(k,{id:f});a.track("killTrackEvent",{_id:d});e.removeTrackEvent(d);c(l._container).remove();z.addTrackEvent.call(k,k);if(v.isScrubberWithin(l)){a=e.getLastTrackEventId();a=z.getTrackEventById(a);a._natives.start(null,a)}i.trigger("videoEditComplete")},editEventCancel:function(){var a=
o.popcornEvent,b;for(b in o.previousValues)if(b)a[b]=o.previousValues[b];o.inPoint=a.start;o.outPoint=a.end;o.parent._draw();B.dialog("close")},editEventOK:function(){z.editEventApply();B.dialog("close")}}}(y);B.tabs();B.css({display:"none"});g.each(h.registry,function(a){c("<li/>",{id:a.type,className:"span-4 select-li clickable",html:"<h3><img class='icon' src='img/"+a.type.split(/\s/)[0].toLowerCase()+".png'> "+g(a.type).capitalize()+"</h3>"}).appendTo("#ui-plugin-select-list")});c.getJSON("layouts/layouts.json",
function(a){g.each(a.layouts,function(b){var d=b.replace(/\s/g,"").toLowerCase();c("<li/>",{html:'<h4><img class="icon" src="img/dummy.png">'+b+"</h4>",className:"select-li clickable"+(E.attr("data-layout")===d?" active":"")}).appendTo(E).data("type",d)})});c.getJSON("themes/themes.json",function(a){g.each(a.themes,function(b){var d=b.replace(/\s/g,"").toLowerCase();c("<li/>",{html:'<h4><img class="icon" src="img/dummy.png">'+b+"</h4>",className:"select-li clickable"+(D.attr("data-theme")===d?" active":
"")}).appendTo(D).data("type",d)})});g.each(["Full Page","Embeddable Fragment","Preview"],function(a){var b=a.split(/\s/)[0].toLowerCase();c("<li/>",{html:'<h4><img class="icon" src="img/'+b+'.png">'+a+"</h4>",className:"select-li clickable"}).appendTo("#ui-export-to").data("type",b)});E.delegate("li","click",function(){var a=c(this);a.toggleClass("active").parents(".is-menu").attr("data-layout",c(this).data("type"));a.siblings().removeClass("active")});D.delegate("li","click",function(){var a=c(this);
a.toggleClass("active").parents(".is-menu").attr("data-theme",c(this).data("type"));a.siblings().removeClass("active")});aa.delegate("li","click",function(){if(!e||!e.data)i.trigger("applicationError",{type:"No Video Loaded",message:"I cannot export your movie - there is no video loaded."});else{var a=c(this).data("type"),b=D.attr("data-theme"),d=E.attr("data-layout"),f=c('[data-export="true"]').filter("div"),j={open:"<!doctype html>\n<html>",head:"\n<head>\n",meta:"<title>"+I.val()+"</title>\n",
theme:'<link rel="stylesheet" href="'+location.href+"themes/"+b+'/theme.css" type="text/css" media="screen">\n',layout:'<link rel="stylesheet" href="'+location.href+"layouts/"+d+'/layout.css" type="text/css" media="screen">\n',scripts:"",body:"\n</head>\n<body>\n",html:"",close:"\n</body>\n</html>\n"},k="";b=["$(function () { ",'  var $p = Popcorn("#video")',"  //uncomment to auto play","  //$p.play();","});\n"];var l="",n=["style","width","height"];g.each(["js/jquery.js","popcorn-js/popcorn.js",
"popcorn-js/plugins/googleMap/popcorn.googleMap.js","popcorn-js/plugins/footnote/popcorn.footnote.js","popcorn-js/plugins/webpage/popcorn.webpage.js","popcorn-js/plugins/flickr/popcorn.flickr.js","popcorn-js/plugins/image/popcorn.image.js","popcorn-js/plugins/wikipedia/popcorn.wikipedia.js"],function(p){if(/plugins/.test(p))p=p.replace("plugins","plugins-playback");j.scripts+='<script src="'+location.href+p+'"><\/script>\n'});d=(new TrackStore).serialize(e.data.trackEvents.byStart);d=JSON.parse(d);
var r=[],t=[];g.each(d.data,function(p){g.each(p,function(s,C){var u=g.extend({},{id:C},s),K={};g.each(u,function(N,ea){K[ea]=!isNaN(+N)?+N:N});r.push(C+"("+JSON.stringify(K)+")");t.push(C)})});if(r.length){f.each(function(){var p=c(this),s=p.clone();p.width();p.height();s.children("#ui-video-controls,hr").remove();if(s.children("video").length){p=c("<div/>",{className:"butter-video-player"});var C=s.children("video").clone();C.attr("controls","controls");p.append('\n        <h1 id="videoTitle">'+
I.val()+"</h1>\n        ").append(C).append('\n        <p id="videoDescription">'+Q.val()+"</p>\n      ");s.children("video").replaceWith(p);k+='\n    <div class="butter-video">\n      '+c.trim(s.html())+"\n    </div>\n  "}if(s.children(".ui-plugin-pane").length){s.children(".ui-plugin-pane").each(function(){var u=c(this);if(g.contains(t,u.data("plugin"))){u.attr("class","butter-plugin").children().remove();g.each(n,function(N){u.removeAttr(N)})}else{var K=u.data("plugin");s.children('[data-plugin="'+
K+'"]').remove()}});k+='\n    <div class="butter-plugins">\n       '+s.html()+"\n    </div>\n"}});b[1]+="."+r.join(".")+";";j.scripts+="\n<script>"+b.join("\n")+"<\/script>";j.html=' <div class="butter-player">'+k+"  </div>";if(a==="full")g.each(j,function(p){l+=p});else l=j.scripts+"\n"+j.theme+"\n"+j.layout+"\n"+j.html;i.trigger("exportReady",{type:a,content:l})}else i.trigger("applicationError",{type:"Stage Empty",message:"I cannot export your movie - the stage is totes empty!"})}});i.bind("applicationError applicationNotice applicationAlert",
function(a,b){var d=function(){c(this).dialog("close");c("#ui-error-rendered").remove()},f={Close:d};if(a.type==="applicationNotice"){f={Cancel:d,Ok:function(){b.callback&&b.callback();d.call(this)}};if(!b.type)b.type="Confirm"}c("<div/>",{id:"ui-error-rendered",html:b.message}).appendTo("#ui-application-error");c("#ui-application-error").dialog({title:b.type,height:b.message?200:0,buttons:f,width:300,modal:true,autoOpen:true})});X=function(){return{typemap:{preview:"iframe",embeddable:"textarea",
full:"textarea"},exports:function(a){this.render[this.typemap[a.type]](a.parent,a.content)},render:{iframe:function(a,b){var d=c("<iframe/>",{id:"ui-preview-rendered"}).width("100%").height(a.height()-100);a.html(d);d=c("#ui-preview-rendered")[0];d=d.contentWindow?d.contentWindow:d.contentDocument.document?d.contentDocument.document:d.contentDocument;d.document.open();d.document.write(b);d.document.close()},textarea:function(a,b){var d=c("<textarea/>",{id:"ui-preview-rendered"}).width(a.width()-100).height(a.height()-
100);d.val(b);a.html(d)}}}}(y);i.bind("exportReady",function(a,b){var d=c("#ui-preview-viewer").dialog({modal:true,width:q.width()-50,height:q.height()-50,autoOpen:true,title:g(b.type).capitalize(),buttons:{Close:function(){c(this).dialog("close");c("#ui-preview-rendered").remove()}}});g.extend(b,{parent:d});X.exports(b)});O.delegate("li","click",function(a){z.addTrackEvent.call(this,a)});c("#ui-start-screen-list, #ui-user-videos").delegate("li","click",function(){var a=c(this),b=a.data("track"),
d=a.data("project");d&&J.project.load(b,d);a.parents("#ui-start-screen-list").length&&c("#ui-start-screen").dialog("close")});w.bind("resize",function(){e.trigger("timeupdate")});i.bind("addTrackComplete",function(){S.css({height:G.height()})});i.bind("removeTrackComplete",function(a,b){var d=h.getTrackEvents(e),f=b.type,j=0;g.each(d,function(k){k._id.indexOf(f)===0&&j++});if(!j){c('div[title="'+f+'"]').remove();delete F[f]}I.val()&&V.save()});i.bind("timelineReady videoReady",function(){S.css({height:G.height()})});
i.bind("videoLoadStart videoLoadComplete",function(a){a.type==="videoLoadStart"?T.show():T.hide()});i.bind("seekComplete",function(a,b){b.special&&b.special();b.type==="last"&&c("#ui-tracks").scrollLeft(c("#ui-tracks-time-canvas").width());b.type==="first"&&c("#ui-tracks").scrollLeft(0)});i.bind("videoEditComplete addTrackComplete",function(){var a=new TrackStore;ba.val(a.serialize(e.data.trackEvents.byStart))});var x=0,R=0,V={load:function(){R=x=0;M.val()?v.loadVideoFromUrl():i.trigger("applicationError",
{type:"No Video Loaded",message:"Please provide a valid movie url. ("+m.accepts.join(", ")+") "})},remove:function(){},save:function(){if(!e||!e.data)i.trigger("applicationError",{type:"No Video Loaded",message:"I cannot add a Track Event - there is no movie loaded."});else{var a=new TrackStore,b=I.val(),d=Q.val(),f=M.val(),j=D.attr("data-theme"),k=E.attr("data-layout"),l;if(b){l=g(b).slug();a.Title(b);a.Description(d);a.Remote(f);a.Theme(j);a.Layout(k);a.read(l)?a.update(l,e.data.trackEvents.byStart):
a.create(e.data.trackEvents.byStart);J.menu.load("#ui-user-videos");c("#ui-user-videos li[data-slug='"+l+"']").trigger("click")}else i.trigger("applicationError",{type:"No Title",message:"You will need to add a title in order to save your project."})}},play:function(){e.video.play()},pause:function(){e.video.pause()},volume:function(a){if(a==="up")R=e.video.volume+0.1;if(a==="down")R=e.video.volume-0.1;e.video.volume=R},seek:function(a){if(a.indexOf(":")>-1){var b=c("#"+(a.split(":")[1]||""));x=g(b.val()).smpteToSeconds()}if(a===
"first"){x=0;i.trigger("seeked","first")}if(a==="prev"){x=g(e.video.currentTime-0.25).fourth();i.trigger("seeked","prev")}if(a==="next"){x=g(e.video.currentTime+0.25).fourth();i.trigger("seeked","next")}if(a==="last"){x=e.video.duration;i.trigger("seeked","last")}if(x>e.video.duration)x=e.video.duration;if(x<0)x=0;e.video.currentTime=x;var d=setInterval(function(){if(e.video.readyState>=3){i.trigger("seekComplete",{type:a,time:x});clearInterval(d)}},1)}};P.bind("click",function(a){if(e.video){c(this);
var b=Math.round(c("#ui-tracks-time-canvas").width()/e.video.duration);a=g(a.offsetX/b).fourth();e.video.currentTime=a}});Y.bind("click",function(a){a.preventDefault();a=c(this);a.attr("data-control")&&V[a.attr("data-control")]()});Z.children("button").bind("click",function(){var a=c(this).children("span").children("span");!e||!e.data?i.trigger("applicationError",{type:"No Video Loaded",message:"I cannot "+a.attr("data-control")+" - there is no video loaded"}):V[a.attr("data-control")](a.attr("data-opt"))});
W.bind("keydown",function(a){a.which===13&&c("#io-current-time").next().trigger("click");a.which===39&&c('[data-opt="next"]').parents("button").trigger("click");a.which===37&&c('[data-opt="prev"]').parents("button").trigger("click")});y.$popcorn=e})})(this,this.document,this.jQuery,this._,this.Popcorn);